---
title: "p8105_hw3_tq2171"
author: "Tingyu Qian"
date: "2024-10-9"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Problem 1
```{r}
# load the library and the dataset
library(p8105.datasets)
data("ny_noaa")
```

In the dataset "ny_noaa", it contains `r nrow(ny_noaa)` and `r ncol(ny_noaa)` columns, which means there are 7 variables. Name of the 7 variables are the following: `r names(ny_noaa)`.

The following are the variables introduction:

id: Weather station ID

date: Date of observation

prcp: Precipitation (tenths of mm)

snow: Snowfall (mm)

snwd: Snow depth (mm)

tmax: Maximum temperature (tenths of degrees C)

tmin: Minimum temperature (tenths of degrees C)

The type of each variable are the following: id is `r class(ny_noaa$id)`,  date is `r class(ny_noaa$date)`, prcp is `r class(ny_noaa$prcp)`, snow is `r class(ny_noaa$snow)`, snwd is `r class(ny_noaa$snwd)`, tmax is `r class(ny_noaa$tmax)`, tmin is `r class(ny_noaa$tmin)`. Variables "prcp", "snow", "snwd" are the integer variables. Variables "id", "tmax" and "tmin" are character variables. There are `r sum(is.na(ny_noaa$prcp))` or `r round((sum(is.na(ny_noaa$prcp))/2595176)*100, 2)`% missing value in the variable "prcp", `r sum(is.na(ny_noaa$snow))` or `r round((sum(is.na(ny_noaa$snow))/2595176)*100, 2)`% missing value in the variable "snow", `r sum(is.na(ny_noaa$snwd))` or `r round((sum(is.na(ny_noaa$snwd))/2595176)*100, 2)`% missing value in the variable "snwd", `r sum(is.na(ny_noaa$tmax))` or `r round((sum(is.na(ny_noaa$tmax))/2595176)*100, 2)`% missing value in the variable "tmax" and `r sum(is.na(ny_noaa$tmin))`  or `r round((sum(is.na(ny_noaa$tmin))/2595176)*100, 2)`% missing value in the variable "tmin". 

```{r,warning=FALSE, message=FALSE}
#load the needed library
library(lubridate)
```

```{r}
# Create separate variables for year, month, and day
ny_noaa$year <- year(ny_noaa$date)
ny_noaa$month <- month(ny_noaa$date)
ny_noaa$day <- day(ny_noaa$date)
```

```{r}
# Precipitation (prcp): Currently in tenths of mm, divide by 10 to convert to millimeters (mm).
ny_noaa$prcp_mm <- ny_noaa$prcp / 10

# Maximum temperature (tmax): In tenths of degrees Celsius, divide by 10 to convert to degrees Celsius.
ny_noaa$tmax <- as.numeric(ny_noaa$tmax)
ny_noaa$tmax_c <- ny_noaa$tmax / 10

#Minimum temperature (tmin): In tenths of degrees Celsius, divide by 10 to convert to degrees Celsius.
ny_noaa$tmin <- as.numeric(ny_noaa$tmin)
ny_noaa$tmin_c <- ny_noaa$tmin / 10
```

```{r}
#Identify the most commonly observed values in "snowfall"

# Count occurrences of each snowfall value
snowfall_counts <- table(ny_noaa$snow)
# Sort the counts in descending order to find the most common values
sorted_snowfall <- sort(snowfall_counts, decreasing = TRUE)
# Display the most common snowfall values
head(sorted_snowfall)
```

The high frequency of 0 snowfall values in the dataset, with over 2 million occurrences, likely reflects the fact that snowfall is not a daily event in many regions, especially outside of winter months. Other smaller values, like 25, 13, and 51 mm, represent light snowfalls, which occur less frequently but are still common in regions with occasional snow. The predominance of zero snowfall days is expected when considering regions that experience seasonal snow or generally warmer climates.

```{r}
# Load necessary libraries
library(dplyr)
library(ggplot2)
```

```{r}
# Filter for January (1) and July (7)
jan_july_data <- ny_noaa %>% 
  filter(month %in% c("1", "7")) %>%
  mutate(month_name = ifelse(month == "1", "January", "July"))
```


```{r}
# Group by station, year, and month, and calculate average max temperature (tmax) per station and month
avg_temp <- jan_july_data %>%
  group_by(id, year, month_name) %>%
  summarise(avg_tmax = mean(tmax_c, na.rm = TRUE))
```

```{r}
# Remove any missing values (if needed)
avg_temp <- avg_temp %>% filter(!is.na(avg_tmax))
# Create a two-panel plot
ggplot(avg_temp, aes(x = year, y = avg_tmax)) +
  geom_point(alpha=0.5) +
  facet_grid(~ month_name) +# Create two panels for January and July
  labs(title = "Average Max Temperature in January and July Across Years",
       x = "Year",
       y = "Average Max Temperature (°C)") +
  theme(legend.position = "bottom")
```

The plot shows clear seasonal differences between January and July temperatures. In January, there is an observable warming trend starting around 1990, with average maximum temperatures increasing over time, possibly suggesting the effects of climate change on winter temperatures. January temperatures often fall below 0°C, with some notable dips close to or below -10°C, indicating particularly cold years or regions. In contrast, July temperatures are more consistent, with average maximum temperatures generally between 25°C and 30°C, showing less variability than January.

There are also some outliers present in the data. In January, certain years show unusually low temperatures, which may represent colder than average years. In July, a few temperatures drop below 20°C, which is unusual for summer and could either reflect rare cooler summers or potential data errors. The overall trend suggests a warming pattern in January, while July temperatures appear more stable.


